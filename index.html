<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Acrati | Puffs, Sofás & Tapizado Premium</title>
  <meta name="description" content="Catálogo con precios + pedidos personalizados por referencia. Personaliza telas y guarda pedidos directamente en Google Sheets." />
  <meta name="theme-color" content="#f5f1ea" />

  <!-- Tipografías -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f1ea;
      --surface:#ffffff;
      --surface2:#fbfaf7;

      --text:#141414;
      --muted:#6b655d;
      --border:#e8e1d7;

      --accent:#1f5b47;      /* verde sobrio premium */
      --accent-ink:#ffffff;
      --gold:#9a7a3a;        /* dorado sobrio */
      --gold-ink:#1a1206;

      --shadow-sm: 0 8px 18px rgba(17,24,39,.06);
      --shadow-md: 0 16px 40px rgba(17,24,39,.08);
      --shadow-lg: 0 26px 70px rgba(17,24,39,.10);

      --radius:22px;
      --radius-sm:16px;
      --max:1140px;

      --font-body: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --font-display: "Playfair Display", ui-serif, Georgia, "Times New Roman", serif;

      --focus: 0 0 0 4px rgba(31,91,71,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:var(--font-body);
      color:var(--text);
      line-height:1.55;
      background:
        radial-gradient(900px 520px at 18% 2%, rgba(31,91,71,.10), transparent 55%),
        radial-gradient(780px 520px at 82% 6%, rgba(154,122,58,.10), transparent 58%),
        var(--bg);
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:var(--max); margin:0 auto; padding:0 18px}

    /* Topbar */
    .topbar{
      background: rgba(255,255,255,.55);
      border-bottom:1px solid rgba(232,225,215,.85);
      backdrop-filter: blur(10px);
    }
    .topbar .row{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 0;
      gap:12px;
      color:var(--muted);
      font-size:13px;
    }
    .topbar b{color:var(--text); font-weight:700}
    .top-links{display:flex; gap:14px; flex-wrap:wrap}
    .top-links a{font-weight:600; color:var(--muted)}
    .top-links a:hover{color:var(--text)}

    /* Header */
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(245,241,234,.78);
      border-bottom:1px solid rgba(232,225,215,.92);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 0;
      gap:12px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(31,91,71,.95), rgba(31,91,71,.75));
      box-shadow: var(--shadow-sm);
      border:1px solid rgba(31,91,71,.22);
      flex:0 0 auto;
    }
    .wordmark{
      font-family: var(--font-display);
      font-size: 26px;
      letter-spacing: .2px;
      line-height:1;
    }
    nav ul{list-style:none; display:flex; gap:18px; margin:0; padding:0; align-items:center}
    nav a{color:var(--muted); font-weight:700; font-size:14px}
    nav a:hover{color:var(--text)}
    .menu-btn{display:none}
    @media (max-width: 920px){
      nav ul{display:none}
      .menu-btn{display:inline-flex}
      .wordmark{font-size:24px}
    }

    /* UI */
    .pill{
      display:inline-flex; gap:10px; align-items:center;
      padding:8px 12px;
      border:1px solid var(--border);
      border-radius:999px;
      background: rgba(255,255,255,.72);
      color:var(--muted);
      font-size:13px;
      font-weight:600;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 16px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.88);
      cursor:pointer;
      transition: transform .16s ease, box-shadow .16s ease, background .16s ease, border-color .16s ease;
      font-weight:700;
      user-select:none;
      color:var(--text);
      box-shadow: var(--shadow-sm);
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px); box-shadow: var(--shadow-md)}
    .btn:focus{outline:none; box-shadow: var(--shadow-md), var(--focus)}
    .btn.primary{
      background: var(--accent);
      border-color: rgba(31,91,71,.35);
      color: var(--accent-ink);
    }
    .btn.primary:hover{background: #1a4d3d}
    .btn.secondary{
      background: rgba(31,91,71,.08);
      border-color: rgba(31,91,71,.28);
      color: var(--accent);
    }
    .btn.secondary:hover{background: rgba(31,91,71,.12)}
    .btn.gold{
      background: rgba(154,122,58,.10);
      border-color: rgba(154,122,58,.28);
      color: #6b4f20;
    }
    .btn.ghost{background:transparent; box-shadow:none}
    .btn.small{padding:10px 12px; border-radius:12px; font-size:13px}
    .ico{display:inline-flex; align-items:center; justify-content:center}

    /* Hero */
    .hero{padding:34px 0 18px}
    .hero-grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:22px;
      align-items:stretch;
    }
    @media (max-width: 980px){ .hero-grid{grid-template-columns:1fr} }

    .h1{
      font-family: var(--font-display);
      font-size: clamp(32px, 3.2vw, 46px);
      line-height:1.05;
      margin:12px 0 10px;
      letter-spacing:-0.6px;
      font-weight: 700;
    }
    .lead{color:var(--muted); font-size:16px; max-width:62ch}
    .cta-row{display:flex; flex-wrap:wrap; gap:10px; margin-top:16px}
    .note{color:var(--muted); font-size:13px; margin-top:10px}

    .hero-card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow-md);
      overflow:hidden;
    }
    .hero-media{
      border-radius: var(--radius);
      overflow:hidden;
      border:1px solid rgba(232,225,215,.95);
      box-shadow: var(--shadow-lg);
      background: rgba(255,255,255,.78);
    }
    .hero-img{
      width:100%;
      height: 340px;
      display:block;
      object-fit:cover;
      object-position:center;
      filter: contrast(1.02) saturate(1.02);
      transform: scale(1.01);
    }

    /* Trust chips */
    .benefits{
      margin-top:14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .benefit{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.86);
      border-radius: 999px;
      font-weight:700;
      color: var(--text);
      box-shadow: var(--shadow-sm);
      font-size:13px;
    }
    .benefit span{font-weight:600; color:var(--muted)}
    .benefit .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(31,91,71,.85);
      box-shadow: 0 6px 12px rgba(31,91,71,.18);
      flex:0 0 auto;
    }

    .mini{font-size:12.5px; color:var(--muted)}
    .tags{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
    .tag{
      font-size:12px; color:var(--muted);
      border:1px solid var(--border);
      background: rgba(255,255,255,.70);
      padding:6px 10px;
      border-radius:999px;
      font-weight:600;
    }

    /* Sections */
    section{padding:34px 0}
    .section-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:14px; margin-bottom:14px;
    }
    .section-title h2{
      margin:0;
      font-family:var(--font-body);
      font-size:22px;
      letter-spacing:-.2px;
      font-weight: 800;
    }
    .section-title p{margin:0; color:var(--muted); font-size:14px}

    .grid-2{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}
    .grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:14px}
    @media (max-width: 900px){
      .grid-2,.grid-3{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--border);
      background: rgba(255,255,255,.84);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow-sm);
    }
    .card h3{margin:0 0 6px; font-size:16px; font-weight:800}
    .card p{margin:0; color:var(--muted); font-size:14px}

    /* Catalog */
    .filters{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 10px 0 14px;
    }
    .filter{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.74);
      font-weight:700;
      cursor:pointer;
      transition:.16s ease;
      font-size:13px;
      user-select:none;
    }
    .filter:hover{box-shadow: var(--shadow-sm)}
    .filter.active{
      border-color: rgba(31,91,71,.28);
      background: rgba(31,91,71,.10);
      color: var(--accent);
    }

    .catalog{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:14px
    }
    @media (max-width: 980px){ .catalog{grid-template-columns:1fr} }

    .product{
      border:1px solid var(--border);
      background: rgba(255,255,255,.88);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      overflow:hidden;
      transition: transform .16s ease, box-shadow .16s ease;
      display:flex;
      flex-direction:column;
      cursor:pointer;
      position:relative;
    }
    .product:hover{transform: translateY(-2px); box-shadow: var(--shadow-md)}
    .product-media{
      width:100%;
      aspect-ratio: 4 / 3;
      background: rgba(255,255,255,.85);
      border-bottom:1px solid var(--border);
      overflow:hidden;
      position:relative;
    }
    .product-img{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      object-position:center;
      transition: transform .24s ease, filter .24s ease;
      filter: saturate(1.02) contrast(1.02);
    }
    .product:hover .product-img{transform: scale(1.03)}
    .product .body{padding:14px 16px; display:flex; flex-direction:column; gap:8px; flex:1}
    .product .body h3{font-size:16px; margin:0; font-weight:800}
    .product .body p{margin:0; color:var(--muted); font-size:14px}

    .badge{
      display:inline-flex;
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:12px;
      border:1px solid rgba(31,91,71,.22);
      background: rgba(31,91,71,.10);
      color: var(--accent);
      align-self:flex-start;
    }
    .badge.alt{
      border-color: rgba(154,122,58,.26);
      background: rgba(154,122,58,.10);
      color: #6b4f20;
    }
    .badge.floating{
      position:absolute;
      top:12px; left:12px;
      backdrop-filter: blur(8px);
      background: rgba(255,255,255,.78);
    }

    .row-between{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .pricebox{
      margin-top:auto;
      padding-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      border-top:1px solid rgba(232,225,215,.9);
    }
    .price{
      font-weight:800;
      font-size:16px;
      letter-spacing:-.2px;
      display:flex;
      align-items:baseline;
      gap:6px;
    }
    .price small{
      font-weight:600;
      font-size:12px;
      color:var(--muted);
      margin:0;
    }

    /* Modales */
    .modal{
      position:fixed; inset:0;
      background:rgba(20,20,20,.45);
      display:none;
      z-index:120;
      padding:18px;
    }
    .modal.open{display:flex; align-items:flex-start; justify-content:center}
    .modal .panel{
      width: min(920px, 100%);
      margin: 34px auto 0;
      border:1px solid var(--border);
      background: rgba(255,255,255,.96);
      border-radius: 22px;
      padding: 16px;
      box-shadow: var(--shadow-lg);
      transform: translateY(4px);
      animation: pop .14s ease both;
    }
    @keyframes pop{
      from{opacity:.0; transform: translateY(10px)}
      to{opacity:1; transform: translateY(0)}
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      margin-bottom: 10px;
    }
    .modal-title{
      font-size:16px;
      font-weight: 800;
      margin:0;
    }
    .modal-sub{margin:6px 0 0; color:var(--muted); font-size:13px}

    label{display:block; font-size:13px; color:var(--muted); margin:10px 0 6px; font-weight:600}
    input, textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.96);
      color:var(--text);
      outline:none;
      font-family: var(--font-body);
      transition: box-shadow .16s ease, border-color .16s ease;
    }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(31,91,71,.30);
      box-shadow: var(--focus);
    }
    textarea{min-height:110px; resize:vertical}
    .form-row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 680px){ .form-row{grid-template-columns:1fr} }

    .notice{
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(31,91,71,.18);
      background: rgba(31,91,71,.08);
      color: #154a33;
      font-weight:600;
      font-size:13px;
      margin-top: 10px;
    }

    /* Menú móvil */
    .menu-modal{
      position:fixed; inset:0;
      background:rgba(20,20,20,.40);
      display:none;
      z-index:110;
      padding:18px;
    }
    .menu-modal.open{display:flex; align-items:flex-start; justify-content:center}
    .menu-modal .panel{
      width:min(560px, 100%);
      margin: 24px auto 0;
      border:1px solid var(--border);
      background: rgba(255,255,255,.96);
      border-radius:18px;
      padding:14px;
      box-shadow: var(--shadow-md);
      animation: pop .14s ease both;
    }
    .mlink{
      display:block;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      margin-top:10px;
      color:var(--muted);
      font-weight:700;
      background: rgba(255,255,255,.92);
    }
    .mlink:hover{color:var(--text); box-shadow: var(--shadow-sm)}

    /* WhatsApp flotante */
    .wa-float{
      position:fixed;
      right:16px;
      bottom:16px;
      z-index:90;
      border-radius:999px;
      padding:12px 14px;
      border:1px solid rgba(31,91,71,.30);
      background: var(--accent);
      color: var(--accent-ink);
      font-weight:800;
      box-shadow: 0 16px 35px rgba(17,24,39,.16);
      display:inline-flex;
      align-items:center;
      gap:10px;
      transition: transform .16s ease, box-shadow .16s ease, background .16s ease;
    }
    .wa-float:hover{transform:translateY(-1px); box-shadow: 0 18px 40px rgba(17,24,39,.18); background:#1a4d3d}
    .wa-float:focus{outline:none; box-shadow: 0 18px 40px rgba(17,24,39,.18), var(--focus)}

    /* Configurador */
    .config-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 860px){ .config-grid{grid-template-columns:1fr} }

    .kv{
      border:1px solid var(--border);
      background: rgba(255,255,255,.92);
      border-radius:16px;
      padding:12px;
    }
    .kv b{display:block; font-size:13px; font-weight:800}
    .kv span{display:block; color:var(--muted); font-size:12.5px; margin-top:2px}

    .swatches{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 520px){ .swatches{grid-template-columns: repeat(3, 1fr)} }

    .swatch{
      border:1px solid var(--border);
      background: rgba(255,255,255,.94);
      border-radius:16px;
      padding:10px;
      cursor:pointer;
      transition:.14s ease;
      box-shadow: var(--shadow-sm);
      text-align:left;
      user-select:none;
    }
    .swatch:hover{ transform: translateY(-1px); box-shadow: var(--shadow-md) }
    .swatch:focus{outline:none; box-shadow: var(--shadow-md), var(--focus)}
    .swatch.active{
      border-color: rgba(31,91,71,.35);
      outline: 2px solid rgba(31,91,71,.14);
    }
    .swatch-top{display:flex; align-items:center; gap:10px}
    .swatch-dot{
      width:22px; height:22px; border-radius:999px;
      border:1px solid rgba(0,0,0,.08);
      background: var(--c, #ddd);
      flex:0 0 auto;
    }
    .swatch-img{
      width:100%;
      height:68px;
      border-radius:12px;
      border:1px solid rgba(232,225,215,.85);
      background: #faf7f2;
      overflow:hidden;
      margin-top:8px;
    }
    .swatch-img img{width:100%; height:100%; object-fit:cover; display:block}
    .swatch-name{font-weight:800; font-size:13px}
    .swatch-meta{color:var(--muted); font-size:12px; margin-top:2px}

    .config-actions{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
    }
    .small-note{font-size:12.5px; color:var(--muted); margin-top:8px}

    /* FAQ */
    .faq details{
      border:1px solid var(--border);
      background: rgba(255,255,255,.84);
      border-radius:16px;
      padding:12px 14px;
      box-shadow: var(--shadow-sm);
    }
    .faq details + details{margin-top:10px}
    .faq summary{
      cursor:pointer;
      font-weight:800;
      list-style:none;
    }
    .faq summary::-webkit-details-marker{display:none}
    .faq p{margin:8px 0 0; color:var(--muted); font-size:14px}

    footer{
      border-top:1px solid rgba(232,225,215,.95);
      padding:18px 0;
      color:var(--muted);
      font-size:13px;
    }
    .footer-row{display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .links{display:flex; gap:12px; flex-wrap:wrap}
    .links a{color:var(--muted); font-weight:700}
    .links a:hover{color:var(--text)}

    /* Toast */
    .toast-wrap{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 200;
      display:flex;
      flex-direction:column;
      gap:10px;
      width:min(520px, calc(100% - 28px));
      pointer-events:none;
    }
    .toast{
      pointer-events:auto;
      border:1px solid var(--border);
      background: rgba(255,255,255,.92);
      border-radius: 16px;
      padding:12px 14px;
      box-shadow: var(--shadow-md);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      animation: pop .14s ease both;
    }
    .toast b{font-weight:800}
    .toast .tmsg{color:var(--muted); font-size:13px; margin-top:4px}
    .toast.success{border-color: rgba(31,91,71,.25); background: rgba(31,91,71,.08)}
    .toast.warn{border-color: rgba(154,122,58,.28); background: rgba(154,122,58,.10)}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="container row">
      <div>Hecho a medida • <b>Tapizado & Retapizado</b> • Lima y Provincias</div>
      <div class="top-links">
        <a href="#amedida">Proceso</a>
        <a href="#tapizado">Tapizado</a>
        <a href="#faq">FAQ</a>
      </div>
    </div>
  </div>

  <header>
    <div class="container nav">
      <a class="brand" href="#top" aria-label="Acrati">
        <span class="logo" aria-hidden="true"></span>
        <span class="wordmark">Acrati</span>
      </a>

      <nav aria-label="Navegación principal">
        <ul>
          <li><a href="#catalogo">Catálogo</a></li>
          <li><a href="#amedida">A medida</a></li>
          <li><a href="#tapizado">Tapizado</a></li>
          <li><a href="#envios">Envíos</a></li>
          <li><a href="#contacto">Contacto</a></li>
        </ul>
      </nav>

      <div style="display:flex; gap:10px; align-items:center">
        <button class="btn secondary menu-btn" id="btn-menu" aria-label="Abrir menú">Menú</button>
        <button class="btn primary" type="button" id="btn-open-quote-cta">Cotizar a medida</button>
      </div>
    </div>
  </header>

  <!-- Menú móvil -->
  <div class="menu-modal" id="menuModal">
    <div class="panel">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
        <b style="font-weight:800">Menú</b>
        <button class="btn ghost" id="btn-menu-close">Cerrar</button>
      </div>
      <a class="mlink" href="#catalogo">Catálogo</a>
      <a class="mlink" href="#amedida">A medida</a>
      <a class="mlink" href="#tapizado">Tapizado</a>
      <a class="mlink" href="#envios">Envíos</a>
      <a class="mlink" href="#contacto">Contacto</a>
    </div>
  </div>

  <!-- Modal de consulta general (A pedido) -->
  <div class="modal" id="quoteModal" aria-hidden="true">
    <div class="panel">
      <div class="modal-header">
        <div>
          <p class="modal-title">Consulta / Pedido a medida</p>
          <p class="modal-sub">Para pedidos por referencia (Pinterest/IG), medidas especiales o retapizado. Se guarda en Google Sheets.</p>
        </div>
        <button class="btn ghost" id="btn-quote-close">Cerrar</button>
      </div>

      <form id="quoteForm">
        <div class="form-row">
          <div>
            <label>Nombre</label>
            <input id="q_nombre" placeholder="Nombre del cliente" required />
          </div>
          <div>
            <label>WhatsApp / Teléfono</label>
            <input id="q_tel" placeholder="Ej: 987654321" />
          </div>
        </div>

        <div class="form-row">
          <div>
            <label>Ciudad</label>
            <input id="q_ciudad" placeholder="Lima / Arequipa / etc." />
          </div>
          <div>
            <label>Producto / Servicio</label>
            <input id="q_producto" placeholder="Ej: Sofá, puff, retapizado..." required />
          </div>
        </div>

        <div class="form-row">
          <div>
            <label>Medidas (aprox.)</label>
            <input id="q_medidas" placeholder="Ej: 180x80x90 cm" />
          </div>
          <div>
            <label>Referencia (link)</label>
            <input id="q_referencia" placeholder="Pinterest/IG" />
          </div>
        </div>

        <label>Detalles</label>
        <textarea id="q_detalles" placeholder="Color/tela, firmeza, fecha, estado del mueble (si es retapizado), etc."></textarea>

        <div class="config-actions">
          <button class="btn primary" type="submit">Guardar solicitud</button>
          <button class="btn secondary" type="button" id="btn-quote-wa">Enviar por WhatsApp</button>
        </div>

        <div class="notice">
          Para coordinar telas y acabados por chat, usa el botón flotante de WhatsApp (esquina).
        </div>
      </form>
    </div>
  </div>

  <!-- Modal configurador (Catálogo) -->
  <div class="modal" id="configModal" aria-hidden="true">
    <div class="panel">
      <div class="modal-header">
        <div>
          <p class="modal-title" id="cfgTitle">Personalizar</p>
          <p class="modal-sub" id="cfgSub">Selecciona tela, color y patas. “Pedir” guarda el pedido en Google Sheets.</p>
        </div>
        <button class="btn ghost" id="btn-cfg-close">Cerrar</button>
      </div>

      <div class="notice">
        Flujo recomendado: cliente elige modelo → elige tela/color/patas → “Pedir” → pago por Yape/Plin.
      </div>

      <div class="config-grid">
        <div>
          <div class="kv">
            <b>Producto</b>
            <span id="cfgProduct">—</span>
          </div>

          <div class="form-row" style="margin-top:10px">
            <div>
              <label>Nombre del cliente</label>
              <input id="cfgCustomer" placeholder="Ej: María" />
            </div>
            <div>
              <label>Teléfono / WhatsApp</label>
              <input id="cfgPhone" placeholder="Ej: 987654321" />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label>Ciudad</label>
              <input id="cfgCity" placeholder="Ej: Lima" />
            </div>
            <div>
              <label>Cantidad</label>
              <input id="cfgQty" type="number" min="1" value="1" />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label>Tipo de tela</label>
              <select id="cfgFabricType"></select>
            </div>
            <div>
              <label>Firmeza</label>
              <select id="cfgFirmness">
                <option value="Suave">Suave</option>
                <option value="Intermedia" selected>Intermedia</option>
                <option value="Firme">Firme</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div>
              <label>Medidas</label>
              <input id="cfgMeasures" placeholder="Ej: 80x80x45 cm" />
            </div>
            <div>
              <label>Patas</label>
              <select id="cfgLegs">
                <option value="Negro" selected>Negro</option>
                <option value="Dorado">Dorado</option>
                <option value="Plateado">Plateado</option>
              </select>
            </div>
          </div>

          <label>Notas / detalles (opcional)</label>
          <textarea id="cfgNotes" placeholder="Ej: fácil limpieza, costura reforzada, entrega urgente, etc."></textarea>

          <div class="config-actions">
            <button class="btn primary" type="button" id="btn-cfg-order">Pedir</button>
            <button class="btn secondary" type="button" id="btn-cfg-wa">Enviar detalle por WhatsApp</button>
          </div>

          <div class="notice" id="paymentBox" style="display:none">
            <b>Siguiente paso: pago</b>
            <div class="mini" style="margin-top:6px">
              Paga por Yape/Plin y luego envíanos la captura usando el botón flotante de WhatsApp.
            </div>
            <div class="mini" style="margin-top:8px"><b>Yape:</b> 999 999 999 (cámbialo)</div>
            <div class="mini"><b>Nombre:</b> Acrati (cámbialo)</div>
            <div style="margin-top:10px">
              <img src="yape-qr.png" alt="QR Yape" style="max-width:220px;border-radius:16px;border:1px solid var(--border)">
            </div>
          </div>

          <div class="small-note">
            Se registrará como <b>event = pedido_configurado</b>. El “combo” queda en la columna <b>detalles</b>.
          </div>
        </div>

        <div>
          <div class="kv">
            <b>Colores / muestras</b>
            <span>Haz clic en una muestra para seleccionarla.</span>
          </div>
          <div class="swatches" id="cfgSwatches"></div>
          <div class="small-note">
            Si quieres mini-fotos reales: sube imágenes a <b>telas/</b> y asigna <b>img</b> en el catálogo de telas del script.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WhatsApp flotante (único) -->
  <a class="wa-float" id="btn-wa-float" href="#" rel="noopener">
    <span class="ico" aria-hidden="true">
      <svg viewBox="0 0 32 32" width="18" height="18" fill="currentColor">
        <path d="M19.11 17.46c-.27-.14-1.6-.79-1.85-.88-.25-.09-.43-.14-.61.14-.18.27-.7.88-.86 1.06-.16.18-.32.2-.59.07-.27-.14-1.16-.43-2.2-1.36-.81-.72-1.35-1.6-1.51-1.87-.16-.27-.02-.42.12-.56.13-.13.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.48-.07-.14-.61-1.47-.84-2.01-.22-.52-.44-.45-.61-.46l-.52-.01c-.18 0-.48.07-.73.34-.25.27-.95.93-.95 2.27s.98 2.64 1.12 2.82c.14.18 1.93 2.95 4.68 4.13.66.29 1.18.46 1.58.59.66.21 1.26.18 1.73.11.53-.08 1.6-.65 1.83-1.28.23-.63.23-1.17.16-1.28-.07-.11-.25-.18-.52-.32z"/>
        <path d="M16.02 3C9.39 3 4 8.37 4 14.98c0 2.34.69 4.61 2 6.56L5 29l7.64-1.99c1.9 1.04 4.05 1.58 6.25 1.58C25.61 28.59 31 23.22 31 16.61 31 10 25.61 3 16.02 3zm0 23.2c-2.02 0-3.99-.56-5.7-1.62l-.41-.25-4.53 1.18 1.2-4.41-.27-.45a9.61 9.61 0 0 1-1.48-5.17c0-5.31 4.35-9.64 9.69-9.64 5.34 0 9.69 4.33 9.69 9.64 0 5.31-4.35 9.72-9.69 9.72z"/>
      </svg>
    </span>
    WhatsApp
  </a>

  <!-- Toast -->
  <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>

  <main id="top" class="container">
    <section class="hero">
      <div class="hero-grid">
        <div>
          <span class="pill">Puffs • Sofás • Retapizado • Lima & Provincias</span>
          <h1 class="h1">Diseños cómodos y elegantes, hechos a medida con tapizado premium.</h1>
          <p class="lead">
            Elige un modelo del catálogo o envíanos una referencia (Pinterest/IG). Personaliza telas y acabados; registramos tu pedido en Google Sheets para cotizar y producir con orden.
          </p>

          <div class="cta-row">
            <a class="btn secondary" href="#catalogo">Ver catálogo</a>
            <button class="btn primary" type="button" id="btn-open-tryon">Personalizar un modelo</button>
            <button class="btn gold" type="button" id="btn-open-quote">Cotizar a medida</button>
          </div>

          <div class="note">Soporte por chat exclusivamente desde el botón flotante de WhatsApp.</div>

          <div class="benefits">
            <div class="benefit"><span class="dot"></span>Personalización <span>tela, color, patas</span></div>
            <div class="benefit"><span class="dot"></span>Proceso claro <span>registro a Sheets</span></div>
            <div class="benefit"><span class="dot"></span>Envíos <span>Lima y provincias</span></div>
            <div class="benefit"><span class="dot"></span>Post-venta <span>retapizado</span></div>
          </div>
        </div>

        <div class="hero-card">
          <div class="hero-media">
            <img class="hero-img" src="hero.png" alt="Acrati - Foto principal"
              onerror="this.style.display='none'; this.parentElement.style.padding='18px'; this.parentElement.innerHTML='<b>Imagen no encontrada</b><div class=&quot;mini&quot; style=&quot;margin-top:6px&quot;>Verifica que <code>hero.png</code> esté junto a <code>index.html</code>.</div>';">
          </div>
          <div style="margin-top:12px">
            <b style="display:block; font-size:16px; font-weight:800">Entrega y empaque</b>
            <div class="mini">Protección: film + burbuja + cartón. Incluye recibo/boleta impresa.</div>
            <div class="tags">
              <span class="tag">Shalom interprovincial</span>
              <span class="tag">Entrega Lima</span>
              <span class="tag">Seguimiento</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="catalogo">
      <div class="section-title">
        <div>
          <h2>Catálogo</h2>
          <p>Clic en el modelo o en “Pedir” para abrir el configurador.</p>
        </div>
        <button class="btn secondary" type="button" id="btn-open-quote-top">Cotizar a medida</button>
      </div>

      <div class="filters" aria-label="Filtros">
        <button class="filter active" data-filter="all" type="button">Todos</button>
        <button class="filter" data-filter="puffs" type="button">Puffs</button>
        <button class="filter" data-filter="pedido" type="button">A pedido</button>
      </div>

      <div class="catalog" id="catalogGrid">

        <!-- ROSSETA (catálogo con precio) -->
        <article class="product" data-category="puffs" data-name="Rosseta" data-price="430" data-img="rosseta.png" data-measures="80x80x45 cm">
          <div class="product-media">
            <span class="badge floating">Catálogo</span>
            <img class="product-img" src="rosseta.png" alt="Rosseta"
              onerror="this.style.display='none'; this.parentElement.style.padding='16px'; this.parentElement.innerHTML='<b>Imagen no encontrada</b><div class=&quot;mini&quot; style=&quot;margin-top:6px&quot;>Verifica <code>rosseta.png</code> junto a <code>index.html</code>.</div>';">
          </div>
          <div class="body">
            <div class="row-between">
              <h3>Rosseta</h3>
              <span class="badge">Personalizable</span>
            </div>
            <p>Puff moderno, cómodo y elegante. Tela y tono personalizables.</p>

            <div class="pricebox">
              <div class="price"><small>Precio</small>S/ 430</div>
              <button class="btn small primary" type="button" data-open-config>Pedir</button>
            </div>
          </div>
        </article>

        <!-- A PEDIDO -->
        <article class="product" data-category="pedido" data-name="Modelo por referencia (Pinterest)" data-price="" data-img="">
          <div class="product-media" style="display:flex; align-items:center; justify-content:center; padding:16px">
            <div>
              <span class="badge">A pedido</span>
              <div style="margin-top:8px; font-weight:800">Modelo por referencia</div>
              <div class="mini" style="margin-top:6px">Envíanos foto o link (Pinterest/IG). Coordinamos por WhatsApp (botón flotante).</div>
            </div>
          </div>
          <div class="body">
            <div class="row-between">
              <h3>Diseño personalizado</h3>
              <span class="badge alt">Cotización</span>
            </div>
            <p>Completa el formulario y lo registramos en Sheets para cotizar.</p>

            <div class="pricebox">
              <div class="price"><small>Precio</small>Consultar</div>
              <button class="btn small primary" type="button" id="btn-open-quote-card">Solicitar cotización</button>
            </div>
          </div>
        </article>

      </div>

      <p class="mini" style="margin-top:10px">
        Importante: para que las imágenes se vean, los archivos deben llamarse exactamente igual (minúsculas) y estar en la misma carpeta que <b>index.html</b>.
      </p>
    </section>

    <section id="amedida">
      <div class="section-title">
        <div>
          <h2>Proceso a medida</h2>
          <p>Para pedidos por referencia (Pinterest/IG) o medidas especiales.</p>
        </div>
      </div>

      <div class="grid-3">
        <div class="card"><h3>1) Referencia</h3><p>Foto/link + uso del mueble + ciudad + medidas aproximadas.</p></div>
        <div class="card"><h3>2) Tela y acabados</h3><p>Seleccionamos tela, color, patas y firmeza. Coordinación por WhatsApp.</p></div>
        <div class="card"><h3>3) Producción y envío</h3><p>Casco + espuma + tapizado. Entrega en Lima o envío a provincias.</p></div>
      </div>
    </section>

    <section id="tapizado">
      <div class="section-title">
        <div>
          <h2>Tapizado y retapizado</h2>
          <p>Renueva tu mueble: estética, confort y durabilidad.</p>
        </div>
        <button class="btn secondary" type="button" id="btn-open-quote-tapizado">Cotizar retapizado</button>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>¿Qué incluye?</h3>
          <p>Evaluación, propuesta de telas, cambio de espuma (opcional) y acabado final con costuras reforzadas.</p>
          <div class="tags"><span class="tag">Chenille</span><span class="tag">Antimanchas</span><span class="tag">Velvet</span></div>
        </div>
        <div class="card">
          <h3>Ideal para</h3>
          <p>Hogares, departamentos, Airbnb, negocios: renueva sin comprar un mueble nuevo.</p>
          <div class="tags"><span class="tag">Durabilidad</span><span class="tag">Fácil limpieza</span><span class="tag">Premium look</span></div>
        </div>
      </div>
    </section>

    <section id="envios">
      <div class="section-title">
        <div>
          <h2>Envíos</h2>
          <p>Lima + provincias con embalaje seguro.</p>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>Lima</h3>
          <p>Coordinación en ventana de horario. Entrega segura según zona.</p>
          <div class="tags"><span class="tag">Entrega coordinada</span><span class="tag">Embalaje</span></div>
        </div>
        <div class="card">
          <h3>Provincias</h3>
          <p>Envíos por Shalom con guía y seguimiento.</p>
          <div class="tags"><span class="tag">Shalom</span><span class="tag">Seguimiento</span></div>
        </div>
      </div>
    </section>

    <section id="faq">
      <div class="section-title">
        <div>
          <h2>Preguntas frecuentes</h2>
          <p>Respuestas rápidas para cerrar ventas con confianza.</p>
        </div>
      </div>

      <div class="faq">
        <details>
          <summary>¿Cuánto demora la producción?</summary>
          <p>Depende del modelo, tela y cola de producción. Te confirmamos fecha estimada al registrar tu pedido/cotización.</p>
        </details>
        <details>
          <summary>¿Puedo elegir tela antimanchas?</summary>
          <p>Sí. En el configurador tienes opciones “Antimanchas (fácil limpieza)” y otras gamas premium.</p>
        </details>
        <details>
          <summary>¿Cómo se paga?</summary>
          <p>Por ahora trabajamos con Yape/Plin. Tras “Pedir”, se muestra el QR y coordinas la captura por WhatsApp.</p>
        </details>
        <details>
          <summary>¿Retapizan muebles existentes?</summary>
          <p>Sí. Envía fotos/medidas y describe el estado (espuma, estructura, uso). Registramos tu solicitud y cotizamos.</p>
        </details>
      </div>
    </section>

    <section id="contacto">
      <div class="section-title">
        <div>
          <h2>Contacto</h2>
          <p>WhatsApp por el botón flotante. A pedido/retapizado: formulario.</p>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>Pedidos a medida / retapizado</h3>
          <p>Registra tu requerimiento en Sheets para cotizar rápido.</p>
          <div style="margin-top:12px">
            <button class="btn primary" type="button" id="btn-open-quote-bottom">Abrir formulario</button>
          </div>
          <div class="notice">Para coordinar por chat, usa el botón flotante de WhatsApp (esquina).</div>
        </div>
        <div class="card">
          <h3>Pagos</h3>
          <p>Sin pasarela por ahora. Trabajamos con Yape/Plin. El QR se muestra después de “Pedir”.</p>
          <div class="notice">Luego envías el comprobante por WhatsApp (botón flotante).</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container footer-row">
      <div>© <span id="year"></span> Acrati.</div>
      <div class="links">
        <a href="#catalogo">Catálogo</a>
        <a href="#tapizado">Tapizado</a>
        <a href="#contacto">Contacto</a>
      </div>
    </div>
  </footer>

  <script>
    // =========================
    // CONFIGURA TUS DATOS AQUÍ
    // =========================
    const WHATSAPP_NUMBER = "51999999999"; // Ej: 51987654321 (51 + número, sin +)

    // Tu Web App URL de Apps Script
    const SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxykQZyRzldx10RUdT6v2TqgFNq8YhpHSVz24KMv_N40-uAKrBmCsMwSAqZ1PBMxPMp/exec";

    const waLink = (text) => `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;

    // ===== Toast (reemplaza alert) =====
    const toastWrap = document.getElementById("toastWrap");
    const toast = (title, msg="", variant="success", ttl=3400) => {
      if (!toastWrap) return;
      const el = document.createElement("div");
      el.className = `toast ${variant}`;
      el.innerHTML = `
        <div>
          <b>${title}</b>
          ${msg ? `<div class="tmsg">${msg}</div>` : ""}
        </div>
        <button class="btn ghost small" type="button" aria-label="Cerrar">Cerrar</button>
      `;
      const btn = el.querySelector("button");
      btn.addEventListener("click", () => el.remove());
      toastWrap.appendChild(el);
      setTimeout(() => { if (el && el.parentElement) el.remove(); }, ttl);
    };

    // WhatsApp: solo botón flotante
    const waFloat = document.getElementById("btn-wa-float");
    if (waFloat) waFloat.href = waLink("Hola, quiero ayuda con mi pedido. ¿Me orientas?");

    // Año
    document.getElementById("year").textContent = new Date().getFullYear();

    // ====== Guardado local (respaldo) ======
    const saveLeadLocal = (row) => {
      const key = "acrati_rows";
      const existing = JSON.parse(localStorage.getItem(key) || "[]");
      existing.unshift(row);
      localStorage.setItem(key, JSON.stringify(existing));
    };

    // ====== Enviar a Sheets ======
    const postToSheets = async (row) => {
      if (!SHEETS_WEBAPP_URL) return { ok:false, skipped:true };
      try{
        await fetch(SHEETS_WEBAPP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(row)
        });
        return { ok:true };
      }catch(e){
        return { ok:false, error:String(e) };
      }
    };

    // ====== Menú móvil ======
    const menuModal = document.getElementById("menuModal");
    const openBtn = document.getElementById("btn-menu");
    const closeBtn = document.getElementById("btn-menu-close");
    if (openBtn) openBtn.addEventListener("click", () => menuModal.classList.add("open"));
    if (closeBtn) closeBtn.addEventListener("click", () => menuModal.classList.remove("open"));
    menuModal.addEventListener("click", (e) => { if (e.target === menuModal) menuModal.classList.remove("open"); });
    document.querySelectorAll(".menu-modal a.mlink").forEach(a => a.addEventListener("click", () => menuModal.classList.remove("open")));

    // Cerrar modales con ESC
    document.addEventListener("keydown", (e) => {
      if (e.key !== "Escape") return;
      if (menuModal.classList.contains("open")) menuModal.classList.remove("open");
      if (quoteModal.classList.contains("open")) closeQuote();
      if (configModal.classList.contains("open")) closeConfig();
    });

    // ====== Filtros ======
    const setActiveFilter = (value) => {
      document.querySelectorAll(".filter").forEach(b => b.classList.toggle("active", b.dataset.filter === value));
      document.querySelectorAll(".product").forEach(p => {
        const cat = p.dataset.category;
        p.style.display = (value === "all" || cat === value) ? "flex" : "none";
      });
    };
    document.querySelectorAll(".filter").forEach(btn => btn.addEventListener("click", () => setActiveFilter(btn.dataset.filter)));

    // =========================
    // Modal "A pedido" (quoteModal)
    // =========================
    const quoteModal = document.getElementById("quoteModal");
    const openQuote = (prefill="") => {
      quoteModal.classList.add("open");
      quoteModal.setAttribute("aria-hidden","false");
      const qp = document.getElementById("q_producto");
      if (qp && prefill) qp.value = prefill;
    };
    const closeQuote = () => {
      quoteModal.classList.remove("open");
      quoteModal.setAttribute("aria-hidden","true");
    };

    document.getElementById("btn-quote-close").addEventListener("click", closeQuote);
    quoteModal.addEventListener("click", (e) => { if (e.target === quoteModal) closeQuote(); });

    // Botones para abrir modal de cotización
    document.getElementById("btn-open-quote").addEventListener("click", () => openQuote(""));
    document.getElementById("btn-open-quote-top").addEventListener("click", () => openQuote("Pedido a medida (Pinterest/IG)"));
    document.getElementById("btn-open-quote-bottom").addEventListener("click", () => openQuote("Pedido a medida (Pinterest/IG)"));
    document.getElementById("btn-open-quote-card").addEventListener("click", (e) => { e.stopPropagation(); openQuote("Diseño personalizado (Pinterest/IG)"); });
    document.getElementById("btn-open-quote-cta").addEventListener("click", () => openQuote("Pedido a medida / retapizado"));
    document.getElementById("btn-open-quote-tapizado").addEventListener("click", () => openQuote("Retapizado / Tapizado"));

    // Enviar resumen por WhatsApp desde modal
    document.getElementById("btn-quote-wa").addEventListener("click", () => {
      const text = `Hola, quiero cotizar:
Nombre: ${document.getElementById("q_nombre").value.trim() || "—"}
Tel: ${document.getElementById("q_tel").value.trim() || "—"}
Ciudad: ${document.getElementById("q_ciudad").value.trim() || "—"}
Producto/Servicio: ${document.getElementById("q_producto").value.trim() || "—"}
Medidas: ${document.getElementById("q_medidas").value.trim() || "—"}
Referencia: ${document.getElementById("q_referencia").value.trim() || "—"}
Detalles: ${document.getElementById("q_detalles").value.trim() || "—"}`;
      window.open(waLink(text), "_blank");
    });

    document.getElementById("quoteForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const row = {
        ts: new Date().toISOString(),
        event: "lead_pedido_a_medida",
        producto: document.getElementById("q_producto").value.trim(),
        precio: "",
        nombre: document.getElementById("q_nombre").value.trim(),
        tel: document.getElementById("q_tel").value.trim(),
        ciudad: document.getElementById("q_ciudad").value.trim(),
        tipo: "A pedido / cotización",
        medidas: document.getElementById("q_medidas").value.trim(),
        referencia: document.getElementById("q_referencia").value.trim(),
        detalles: document.getElementById("q_detalles").value.trim(),
        origen: "web",
        pagina: location.href
      };

      saveLeadLocal(row);
      const res = await postToSheets(row);

      if (res.skipped){
        toast("Solicitud guardada", "Se guardó localmente. Falta configurar SHEETS_WEBAPP_URL.", "warn");
      } else {
        toast("Listo", "Tu solicitud quedó registrada. Para coordinar usa WhatsApp.", "success");
      }
      closeQuote();
    });

    // =========================
    // Configurador de telas (Catálogo)
    // =========================
    const FABRICS = [
      { type: "Chenille premium", note: "Suave, elegante, buena resistencia",
        swatches: [
          { name:"Oliva", color:"#5f6b3e", img:"" },
          { name:"Arena", color:"#d8c7ae", img:"" },
          { name:"Grafito", color:"#4a4a4a", img:"" },
          { name:"Hueso", color:"#f1ede6", img:"" },
        ]
      },
      { type: "Lino / look natural", note: "Textura natural, estética minimal",
        swatches: [
          { name:"Beige", color:"#d9cdbd", img:"" },
          { name:"Taupe", color:"#a89987", img:"" },
          { name:"Blanco roto", color:"#f5f0e8", img:"" },
          { name:"Verde salvia", color:"#8fa38a", img:"" },
        ]
      },
      { type: "Antimanchas (fácil limpieza)", note: "Ideal para negocios y hogares",
        swatches: [
          { name:"Oliva oscuro", color:"#3f4a2a", img:"" },
          { name:"Café", color:"#6b4e35", img:"" },
          { name:"Gris claro", color:"#cfcfcf", img:"" },
          { name:"Azul petróleo", color:"#1f4c57", img:"" },
        ]
      },
      { type: "Terciopelo (velvet)", note: "Brillo sutil, look premium",
        swatches: [
          { name:"Esmeralda", color:"#1f6d57", img:"" },
          { name:"Vino", color:"#6c2734", img:"" },
          { name:"Mostaza", color:"#b08a2e", img:"" },
          { name:"Negro", color:"#1b1b1b", img:"" },
        ]
      },
    ];

    const configModal = document.getElementById("configModal");
    const cfgTitle = document.getElementById("cfgTitle");
    const cfgProduct = document.getElementById("cfgProduct");
    const cfgFabricType = document.getElementById("cfgFabricType");
    const cfgSwatches = document.getElementById("cfgSwatches");
    const cfgCustomer = document.getElementById("cfgCustomer");
    const cfgPhone = document.getElementById("cfgPhone");
    const cfgCity = document.getElementById("cfgCity");
    const cfgQty = document.getElementById("cfgQty");
    const cfgFirmness = document.getElementById("cfgFirmness");
    const cfgMeasures = document.getElementById("cfgMeasures");
    const cfgLegs = document.getElementById("cfgLegs");
    const cfgNotes = document.getElementById("cfgNotes");
    const paymentBox = document.getElementById("paymentBox");

    let CFG = {
      productName: "",
      price: "",
      category: "",
      fabricType: FABRICS[0]?.type || "",
      swatchName: "",
      swatchColor: "",
      swatchImg: ""
    };

    function openConfigFromProduct(card){
      paymentBox.style.display = "none";

      CFG.productName = card?.dataset.name || "Producto";
      CFG.price = card?.dataset.price || "";
      CFG.category = card?.dataset.category || "";

      cfgTitle.textContent = "Personalizar: " + CFG.productName;
      cfgProduct.textContent = CFG.price ? `${CFG.productName} (S/ ${CFG.price})` : `${CFG.productName}`;

      // Medidas definidas (si el producto tiene data-measures)
      const measures = card?.dataset.measures || "";
      if (measures){
        cfgMeasures.value = measures;
        cfgMeasures.readOnly = true;
      } else {
        cfgMeasures.value = "";
        cfgMeasures.readOnly = false;
      }

      // Render select de telas
      cfgFabricType.innerHTML = "";
      FABRICS.forEach(f => {
        const opt = document.createElement("option");
        opt.value = f.type;
        opt.textContent = `${f.type} — ${f.note}`;
        cfgFabricType.appendChild(opt);
      });

      cfgFabricType.value = FABRICS[0]?.type || "";
      CFG.fabricType = cfgFabricType.value;
      renderSwatches(CFG.fabricType);

      // Defaults
      cfgQty.value = 1;
      cfgFirmness.value = "Intermedia";
      cfgLegs.value = "Negro";
      cfgNotes.value = "";

      configModal.classList.add("open");
      configModal.setAttribute("aria-hidden","false");
    }

    function closeConfig(){
      configModal.classList.remove("open");
      configModal.setAttribute("aria-hidden","true");
    }

    document.getElementById("btn-cfg-close").addEventListener("click", closeConfig);
    configModal.addEventListener("click", (e) => { if (e.target === configModal) closeConfig(); });

    cfgFabricType.addEventListener("change", () => {
      CFG.fabricType = cfgFabricType.value;
      renderSwatches(CFG.fabricType);
    });

    function renderSwatches(fabricType){
      const group = FABRICS.find(f => f.type === fabricType) || FABRICS[0];
      cfgSwatches.innerHTML = "";

      CFG.swatchName = "";
      CFG.swatchColor = "";
      CFG.swatchImg = "";

      (group?.swatches || []).forEach((s, idx) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "swatch";
        btn.style.setProperty("--c", s.color || "#ddd");

        btn.innerHTML = `
          <div class="swatch-top">
            <div class="swatch-dot"></div>
            <div>
              <div class="swatch-name">${s.name}</div>
              <div class="swatch-meta">${fabricType}</div>
            </div>
          </div>
          <div class="swatch-img" style="${s.img ? "" : "display:none"}">
            ${s.img ? `<img src="${s.img}" alt="${s.name}">` : ""}
          </div>
        `;

        btn.addEventListener("click", () => {
          document.querySelectorAll(".swatch").forEach(x => x.classList.remove("active"));
          btn.classList.add("active");
          CFG.swatchName = s.name;
          CFG.swatchColor = s.color || "";
          CFG.swatchImg = s.img || "";
        });

        if (idx === 0) btn.click();
        cfgSwatches.appendChild(btn);
      });
    }

    function buildConfiguredComboText(){
      const customer = cfgCustomer.value.trim();
      const phone = cfgPhone.value.trim();
      const city = cfgCity.value.trim();
      const qty = (cfgQty.value || "1").toString().trim();
      const measures = cfgMeasures.value.trim();
      const firmness = cfgFirmness.value;
      const legs = cfgLegs.value;
      const notes = cfgNotes.value.trim();

      return `Pedido (web) - Acrati
Cliente: ${customer || "—"} | Tel: ${phone || "—"} | Ciudad: ${city || "—"}
Producto: ${CFG.productName}${CFG.price ? ` | Precio: S/ ${CFG.price}` : ""}
Cantidad: ${qty}
Tela: ${CFG.fabricType}
Color: ${CFG.swatchName}${CFG.swatchColor ? ` (${CFG.swatchColor})` : ""}
Patas: ${legs}
Medidas: ${measures || "—"}
Firmeza: ${firmness}
Notas: ${notes || "—"}
Página: ${location.href}`;
    }

    document.getElementById("btn-cfg-wa").addEventListener("click", () => {
      const combo = buildConfiguredComboText();
      window.open(waLink(combo), "_blank");
    });

    document.getElementById("btn-cfg-order").addEventListener("click", async () => {
      const combo = buildConfiguredComboText();

      const payload = {
        ts: new Date().toISOString(),
        event: "pedido_configurado",
        producto: CFG.productName,
        precio: CFG.price || "",
        nombre: cfgCustomer.value.trim(),
        tel: cfgPhone.value.trim(),
        ciudad: cfgCity.value.trim(),
        tipo: "Pedido catálogo configurado",
        medidas: cfgMeasures.value.trim(),
        referencia: `Tela: ${CFG.fabricType} | Color: ${CFG.swatchName} | Patas: ${cfgLegs.value}`,
        detalles: combo,
        origen: "web",
        pagina: location.href,
        pago_estado: "Pendiente"
      };

      saveLeadLocal(payload);
      const res = await postToSheets(payload);

      if (res.skipped){
        toast("Pedido guardado", "Se guardó localmente. Falta configurar SHEETS_WEBAPP_URL.", "warn");
        return;
      }

      toast("Pedido registrado", "Ya quedó en Google Sheets. Sigue con el pago por Yape/Plin.", "success");
      paymentBox.style.display = "block";
    });

    // =========================
    // Aperturas (Catálogo / Probador)
    // =========================
    // Botón “Personalizar un modelo” (abre configurador del primer producto de catálogo)
    document.getElementById("btn-open-tryon").addEventListener("click", () => {
      const firstCatalog = document.querySelector('.product[data-category="puffs"]');
      if (firstCatalog) openConfigFromProduct(firstCatalog);
    });

    // Click en tarjetas:
    document.querySelectorAll(".product").forEach(card => {
      // Si es "pedido", abre el formulario
      const isPedido = (card.dataset.category === "pedido");

      // Botón explícito de abrir configurador (Pedir)
      const openCfgBtn = card.querySelector("[data-open-config]");
      if (openCfgBtn){
        openCfgBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          openConfigFromProduct(card);
        });
      }

      // Click general
      card.addEventListener("click", (e) => {
        if (e.target.closest("button") || e.target.closest("a")) return;
        if (isPedido) {
          openQuote("Diseño personalizado (Pinterest/IG)");
          return;
        }
        openConfigFromProduct(card);
      });
    });

    // CTA header
    document.getElementById("btn-open-quote-cta").addEventListener("click", () => openQuote("Pedido a medida / retapizado"));
  </script>
</body>
</html>
